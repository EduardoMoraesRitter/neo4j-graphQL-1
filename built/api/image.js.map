{"version":3,"sources":["../../src/api/image.js"],"names":[],"mappings":"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","file":"image.js","sourcesContent":["module.exports = function(config){\r\n    \r\n    \"use strict\";\r\n    \r\n    var _= require(\"lodash\");\r\n    config = _.extend( require('./config.default'), config);\r\n    var utils = require(\"./utils\")(config);\r\n    var cypher = require(\"./cypher\")(config);\r\n   \r\n\r\nvar that = {\r\n    //options\r\n    //format=compact\r\n    configure : function (image,options) {\r\n\r\n        if (options && options.thumbWidth){\r\n            options.thumbWidth = parseInt(options.thumbWidth);\r\n        }\r\n        var defaultOptions = {format:\"verbose\",thumbWidth:236};\r\n        options = _.extend(defaultOptions,options);\r\n        \r\n        if (image) { \r\n            \r\n            image = utils.camelCase(image);\r\n            \r\n            var contentRoot = config.media.root;\r\n            var isUpload = image.cache && image.cache.indexOf(\"upload/\") === 0;\r\n            \r\n            image.thumb = {\r\n                width: options.thumbWidth,\r\n                height: parseInt(options.thumbWidth / (image.width / image.height))\r\n            };\r\n            //replace url/thumb with cached copy if present (?)\r\n            if (image.cache) {\r\n                image.thumb.url = contentRoot + \"thumbnail/\" + image.cache.replace(/ /g, '%20');\r\n                image.url = contentRoot + \"original/\" + image.cache.replace(/ /g, '%20');\r\n            }\r\n            \r\n            if (image.cacheHigh) {\r\n                image.high={\r\n                    url:contentRoot + \"original/\" + image.cacheHigh.replace(/ /g, '%20')\r\n                };\r\n            }\r\n            \r\n            //Set source info\r\n            if (isUpload) {\r\n                image.source = {\r\n                    name: image.cache.replace(\"upload/\", \"\").substring(0, image.cache.replace(\"upload/\", \"\").indexOf(\"/\")),\r\n                    ref: undefined//add link to user page\r\n                };\r\n            }\r\n            else {\r\n                image.source = {\r\n                    name: image.site ,\r\n                    ref: image.ref || \"http://\" + image.site,\r\n                    url: image.url\r\n                };\r\n            }\r\n\r\n            delete image.cache;\r\n            delete image.site;\r\n            \r\n            //map properties to .full\r\n            image.full = {\r\n                url:image.url,\r\n                width:image.width,\r\n                height:image.height\r\n            };\r\n            \r\n            delete image.url;\r\n            delete image.width;\r\n            delete image.height;\r\n            \r\n            delete image.cacheHigh;\r\n            delete image.urlCaptured;\r\n            delete image.ref;\r\n            delete image.site;\r\n               \r\n        }\r\n        \r\n        return image;\r\n    }\r\n    ,\r\n    //TODO: move cacheError label to image\r\n    error:function(data){\r\n        //data = {pictureId:123,url:\"xxx\"}\r\n        var q= \"match (p:Picture) where ID(p)=\" + data.pictureId + \" set p:NotFound\";\r\n        return cypher.executeQuery(q);\r\n       \r\n        \r\n        \r\n    }\r\n \r\n\r\n\r\n};\r\n\r\n\r\nreturn that;\r\n\r\n\r\n    \r\n    \r\n};\r\n\r\n"]}