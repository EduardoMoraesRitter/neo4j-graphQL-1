{"version":3,"sources":["../../app/api/user.js"],"names":[],"mappings":";;AAAA,OAAO,OAAP,GAAiB,UAAS,MAAT,EAAgB;;AAE7B,iBAF6B;;AAI7B,QAAI,SAAS,QAAQ,QAAR,CAAT,CAJyB;AAK7B,aAAS,OAAQ,QAAQ,kBAAR,CAAR,EAAqC,MAArC,CAAT,CAL6B;;AAO7B,QAAI,SAAS,QAAQ,UAAR,EAAoB,MAApB,CAAT,CAPyB;;AAUjC,QAAI,OAAO;;AAEP,aAAK,aAAU,UAAV,EAAsB;;AAEvB,gBAAI,aAAa,EAAb,CAFmB;;AAIvB,uBAAW,IAAX,CAAgB,OAAO,cAAP,CAAsB,4BAA4B,UAA5B,GAAyC,cAAzC,EAAyD,KAA/E,CAAhB,EAJuB;AAKvB,uBAAW,IAAX,CAAgB,OAAO,cAAP,CAAsB,4BAA4B,UAA5B,GAAyC,oEAAzC,EAA+G,KAArI,CAAhB,EALuB;;AAOvB,mBAAO,OAAO,iBAAP,CAAyB,UAAzB,EAAqC,IAArC,CAA0C,UAAU,OAAV,EAAmB;;AAEhE,oBAAI,OAAO,QAAQ,CAAR,EAAW,IAAX,CAAgB,CAAhB,EAAmB,GAAnB,CAAuB,CAAvB,CAAP,CAF4D;AAGhE,qBAAK,UAAL,GAAkB,EAAlB,CAHgE;;AAKhE,qBAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,QAAQ,CAAR,EAAW,IAAX,CAAgB,MAAhB,EAAwB,GAA5C,EAAiD;;AAE7C,wBAAI,MAAM,QAAQ,CAAR,EAAW,IAAX,CAAgB,CAAhB,CAAN,CAFyC;AAG7C,wBAAI,YAAY,IAAI,GAAJ,CAAQ,CAAR,CAAZ,CAHyC;AAI7C,yBAAK,UAAL,CAAgB,SAAhB,IAA6B,EAAE,IAAI,SAAJ,EAA/B,CAJ6C;iBAAjD;AAMA,uBAAO,IAAP,CAXgE;aAAnB,CAAjD,CAPuB;SAAtB;;AAuBL,uBAAe,uBAAU,IAAV,EAAe,IAAf,EAAqB;;AAEhC,gBAAI,aAAa,EAAb,CAF4B;;AAIhC,gBAAI,IAAI,yBAAyB,KAAK,MAAL,GAAc,0BAAvC,CAJwB;AAKhC,iBAAK,uCAAuC,KAAK,MAAL,GAAc,qBAArD,GAA6E,KAAK,EAAL,GAAU,yEAAvF,CAL2B;;AAOhC,uBAAW,IAAX,CAAgB,OAAO,cAAP,CAAsB,CAAtB,EAAyB,IAAzB,EAA+B,IAA/B,EAAqC,IAArC,CAAhB,EAPgC;AAQhC,mBAAO,OAAO,iBAAP,CAAyB,UAAzB,CAAP,CARgC;SAArB;KAzBf,CAV6B;;AAgDjC,WAAO,IAAP,CAhDiC;CAAhB","file":"user.js","sourcesContent":["module.exports = function(config){\r\n    \r\n    \"use strict\";\r\n    \r\n    var extend = require('extend');\r\n    config = extend (require('./config.default'), config);\r\n\r\n    var cypher = require(\"./cypher\")(config);\r\n\r\n\r\nvar that = {\r\n    \r\n    get: function (userLookup) {\r\n        \r\n        var statements = [];\r\n        \r\n        statements.push(cypher.buildStatement(\"match (n:User {Lookup:'\" + userLookup + \"'}) return n\", \"row\"));\r\n        statements.push(cypher.buildStatement(\"match (n:User {Lookup:'\" + userLookup + \"'}) - [r:FAVOURITE] - (f:Favourite) - [] -> (item) return ID(item)\", \"row\"));\r\n\r\n        return cypher.executeStatements(statements).then(function (results) {\r\n            //    console.log(results);\r\n            var user = results[0].data[0].row[0];\r\n            user.favourites = {};\r\n            \r\n            for (var i = 0; i < results[1].data.length; i++) {\r\n                \r\n                var fav = results[1].data[i];\r\n                var favNodeId = fav.row[0];\r\n                user.favourites[favNodeId] = { id: favNodeId };\r\n            }\r\n            return user;\r\n        });\r\n\r\n    }\r\n      ,\r\n    saveFavourite: function (node,user) {\r\n\r\n        var statements = [];\r\n        \r\n        var s = \"create (n:Favourite:\" + user.Lookup + \" {created:timestamp()}) \";\r\n        s += \"with n MATCH (b),(u:User {Lookup:'\" + user.Lookup + \"'}) where  ID(b) = \" + node.id + \" create (u) - [s:FAVOURITE]->(n)-[r:FAVOURITE]->(b)  return ID(r),ID(s)\";\r\n\r\n        statements.push(cypher.buildStatement(s, null, null, true));\r\n        return cypher.executeStatements(statements);\r\n    }\r\n};\r\n\r\n\r\nreturn that;\r\n\r\n\r\n    \r\n    \r\n};\r\n\r\n"]}